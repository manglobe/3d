(function(){var e=["css/contacts.css"],t=function(){var e=document.scripts,t="contacts.js";curJs=null,curJsSrc=null,curJsName=null;for(var n=0;n<e.length;n++){curJs=e[n];curJsSrc=curJs.src;curJsName=curJsSrc.substring(curJsSrc.lastIndexOf("/")+1,curJsSrc.length);if(curJsName==t){return curJsSrc.substring(0,curJsSrc.lastIndexOf("/")+1)}}}(),n=document.getElementsByTagName("head")[0];for(var a=0;a<e.length;a++){var c=document.createElement("link");c.rel="stylesheet";c.href=t+e[a];n.appendChild(c)}})();(function(e){var t=function(e){if(e[0]=="#"){return document.getElementById(e.replace("#",""))}else{return document.querySelector(e)}},n=function(e,t){var n="t";if(t[0]==".")n="c";if(t[0]=="#")n="i";var a=e;var c="";function i(){c=a;if(c.tagName=="HTML")return c=undefined;a=c.parentNode;if(n=="c"&&c.classList.contains(t.replace(".",""))){return c}else if(n=="i"&&c.id==t.replace("#","")){return c}else if(n=="t"&&c.tagName.toLocaleLowerCase()==t){return c}else{i()}}i();return c},a=function(e){return document.createElement(e)},c=function(e){var t=e.childNodes,n=t.length,a=[];for(var c=0;c<n;c++){if(t[c].nodeType==1)a.push(t[c])}return a},i=function(e,t){e.appendChild(t)},s=function(e,t,n){var a=c(e),i=a.length;if(i&&!t){for(var s=0;s<i;s++){e.removeChild(a[s])}}else if(t&&n){for(var s=t;s<i+1;s++){e.removeChild(a[s-1])}}else if(t){e.removeChild(a[t-1])}},o=function(e,t,n){e.addEventListener(t,n,false)},r=function(e,t,n){e.removeEventListener(t,n,false)},l=function(e,t){e.className=t},d=function(e,t,n){e.setAttribute(t,n)},f=function(e,t){e.style.display=t==undefined?"block":"inline-block"},p=function(e){e.style.display="none"},u=true,h={departSelected:false,totalAjaxCount:0};e.Contacts=function(e,n){this.el=e;this.$el=t(e);if(!this.$el)return;this.init(n)};Contacts.prototype.init=function(e){var t=this;t.ot={contactId:e&&e.contactId||null,selectType:e&&e.selectType||"checkbox",departEnable:e&&e.departEnable||true,departSelect:e&&e.departSelect||"checkbox",personEnable:e&&e.personEnable||true,personSelect:e&&e.personSelect||"checkbox",personNameShow:e&&e.personNameShow||true,backBtnShow:e&&e.backBtnShow||false,confirmBtnName:e&&e.confirmBtnName||"确认",myDepartmentId:e&&e.myDepartmentId||-1,selectSt:e&&e.selectSt||undefined,selectEn:e&&e.selectEn||undefined};t.$el.webrischa=true;o(t.$el,"click",function(){h.opts=t.ot;q()})};function v(){h.keyWords=h.$input.value.replace(/(^\s*)|(\s*$)/g,"");if(!h.keyWords)return;h.departSelected=false;m()}function m(){B();p(h.$searchNodata);s(h.$navList,2,true);var e=h.$navItem.cloneNode();e.innerHTML="搜索";e.id="searchNavBtn";e.index=c(h.$navList).length+1;o(e,"click",function(){if(this.index==c(h.$navList).length)return;var e=this.index+1;s(h.$navList,e,true);B();p(h.$searchNodata);h.departSelected=false;b(1)});i(h.$navList,e);b(1)}function g(){h.scrollTop=window.scrollY;h.docHeight=document.body.parentNode.offsetHeight;h.windowHeight=window.innerHeight;if(h.docHeight-(h.scrollTop+h.windowHeight)<50){b(h.pageSearchIndex,true)}}function L(){h.scrollTop=window.scrollY;h.docHeight=document.body.parentNode.offsetHeight;h.windowHeight=window.innerHeight;if(h.docHeight-(h.scrollTop+h.windowHeight)<50){S(h.departmentId,h.pageListIndex,true)}}function b(e,t){h.totalAjaxCount++;r(window,"scroll",g);r(window,"scroll",L);$.ajax({url:"http://localhost:3004/nodata",type:"GET",dataType:"json",data:{keyWords:h.keyWords,pageIndex:e||1,personOnly:t||false,totalAjaxCount:h.totalAjaxCount},success:function(e){var t=e.obj,n=t.departments,a=t.personPage.items;if(n.length){for(var c=0;c<n.length;c++){i(h.$departList,y({id:n[c].id,name:n[c].name,type:"department"}))}}if(a.length){for(var c=0;c<a.length;c++){i(h.$staffList,w({id:a[c].id,name:a[c].name,logo:a[c].logo,headImage:a[c].headImage,jobs:a[c].jobs,mobileFir:a[c].mobileFir,type:"person"}))}}if(!n.length&&!a.length){f(h.$searchNodata);return}C();if(t.personPage.isHasNextPage){h.pageSearchIndex=t.personPage.pageIndex+1;o(window,"scroll",g)}}})}function S(e,t,n){h.totalAjaxCount++;r(window,"scroll",L);$.ajax({url:"http://localhost:3004/list"+e,type:"GET",dataType:"json",data:{departId:e||"",pageIndex:t||1,personOnly:n||false,totalAjaxCount:h.totalAjaxCount},success:function(t){var n=t.obj,a=n.departments,c=n.personPage.items;if(a.length){for(var s=0;s<a.length;s++){i(h.$departList,y({id:a[s].id,name:a[s].name,type:"department"}))}}if(c.length){for(var s=0;s<c.length;s++){i(h.$staffList,w({id:c[s].id,name:c[s].name,logo:c[s].logo,headImage:c[s].headImage,jobs:c[s].jobs,mobileFir:c[s].mobileFir,type:"person"}))}}C();if(n.personPage.isHasNextPage){h.departmentId=e;h.pageListIndex=n.personPage.pageIndex+1;o(window,"scroll",L)}}})}function k(){h.$input.value="";r(window,"scroll",g);h.departSelected=false;B();p(h.$searchNodata);i(h.$departList,y({id:h.opts.myDepartmentId,name:"我的部门",type:"department"},"my"));S("")}function y(e,t){var n=h.$departItem.cloneNode(),a=h.$checkLabel.cloneNode(),c=h.$checkBox.cloneNode(),s=h.$departDetail.cloneNode();c.contact=e;if(t)s.classList.add(t);s.innerHTML=e.name;o(c,"click",function(){var t=this.checked;H(t,e,this)});o(s,"click",function(){B();i(h.$navList,N(e));h.$navList.scrollLeft=1e5;h.curDepartmentId=e.id;D();S(e.id)});if(h.opts.departEnable=="off"&&e.id!=h.opts.myDepartmentId){c.disabled=true;c.classList.add("contact-select-noallow")}if(e.id==h.opts.myDepartmentId){c.disabled=true;c.classList.add("contact-select-goto")}i(a,c);i(n,a);i(n,s);return n}function w(e){var t=h.$staffItem.cloneNode(),n=h.$checkLabel.cloneNode(),a=h.$checkBox.cloneNode(),c=h.$staffDetail.cloneNode();a.contact=e;c.innerHTML='<img class="staff-detail-icon" src="'+(e.logo||e.headImage)+'"><div class="staff-detail-info"><p class="staff-detail-name">'+e.name+'</p><p class="staff-detail-other"><span class="staff-detail-jobs">'+(e.jobs||"未知")+"</span><span>"+(e.mobileFir||"")+"</span></p></div>";o(a,"click",function(){var t=this.checked;H(t,e,this)});if(h.opts.personEnable=="off"){a.disabled=true;a.classList.add("contact-select-noallow")}i(n,a);i(t,n);i(t,c);return t}function N(e){var t=h.$navItem.cloneNode();t.innerHTML=e.name;t.id=e.id;t.index=c(h.$navList).length+1;o(t,"click",function(){if(this.index==c(h.$navList).length)return;var t=this.index+1;s(h.$navList,t,true);B();D();S(e.id)});return t}function x(e){var t=h.$selectDepartItem.cloneNode();t.contact=e;t.innerHTML=e.name;o(t,"click",function(){this.parentNode.removeChild(this);j(e)});return t}function I(e){var t=h.$selectStaffItem.cloneNode(),n='<img class="selected-staff-icon" src="'+(e.logo||e.headImage)+'">';if(h.opts.personNameShow!="off")n+='<span class="selected-staff-name">'+e.name+"</span>";t.contact=e;t.innerHTML=n;o(t,"click",function(){this.parentNode.removeChild(this);j(e)});return t}function B(){s(h.$departList);s(h.$staffList)}function D(){h.departSelected=false;var e=c(h.$selectDepartList),t=c(h.$navList);if(e.length){for(var n=0;n<e.length;n++){var a=e[n].contact;if(t.length>1){for(var i=1;i<t.length;i++){if(t[i].id==a.id){h.departSelected=true;break}}}if(h.departSelected)break}}}function T(){var e=h.$ctWrap.querySelectorAll("input[type=checkbox]");for(var t=0;t<e.length;t++){if(e[t].checked==false)e[t].disabled=true}}function C(e){var t=c(h.$selectDepartList),n=c(h.$selectStaffList);if(t.length&&!e){for(var a=0;a<t.length;a++){var i=t[a].contact.id,s=h.$departList.querySelectorAll("input[type=checkbox]");for(var o=0;o<s.length;o++){if(s[o].contact.id==i){s[o].checked=true;break}}}}if(n.length){for(var a=0;a<n.length;a++){var i=n[a].contact.id,s=h.$staffList.querySelectorAll("input[type=checkbox]");for(var o=0;o<s.length;o++){if(s[o].contact.id==i){s[o].checked=true;break}}}}if(h.departSelected)T()}function H(e,t,n){if(e){W(t)}else{j(t,n)}}function W(e){if(e.type=="department"){i(h.$selectDepartList,x(e))}else if(e.type=="person"){i(h.$selectStaffList,I(e))}if(h.opts.selectType=="radio"){if(c(h.$selectDepartList).length){var e=c(h.$selectDepartList)[0].contact;c(h.$selectDepartList)[0].parentNode.removeChild(c(h.$selectDepartList)[0]);j(e)}else if(c(h.$selectStaffList).length){var e=c(h.$selectStaffList)[0].contact;c(h.$selectStaffList)[0].parentNode.removeChild(c(h.$selectStaffList)[0]);j(e)}}if(h.opts.selectType=="off"){if(h.opts.departSelect=="radio"&&c(h.$selectDepartList).length>1){var e=c(h.$selectDepartList)[0].contact;c(h.$selectDepartList)[0].parentNode.removeChild(c(h.$selectDepartList)[0]);j(e)}if(h.opts.personSelect=="radio"&&c(h.$selectStaffList).length>1){var e=c(h.$selectStaffList)[0].contact;c(h.$selectStaffList)[0].parentNode.removeChild(c(h.$selectStaffList)[0]);j(e)}}E()}function j(e,t){if(e.type=="department"){if(t){var n=c(h.$selectDepartList)}else{D();var n=h.$departList.querySelectorAll("input[type=checkbox]");if(h.departSelected==false){for(var a=0;a<n.length;a++){n[a].disabled=false}if(h.opts.personEnable!="off"){var i=h.$staffList.querySelectorAll("input[type=checkbox]");for(var a=0;a<i.length;a++){i[a].disabled=false}}}}for(var a=0;a<n.length;a++){if(n[a].contact.id==e.id){if(t){n[a].parentNode.removeChild(n[a]);if(h.departSelected)t.disabled=true}else{n[a].checked=false;if(h.departSelected)n[a].disabled=true}break}}}else if(e.type=="person"){if(t){var n=c(h.$selectStaffList)}else{var n=h.$staffList.querySelectorAll("input[type=checkbox]")}for(var a=0;a<n.length;a++){if(n[a].contact.id==e.id){if(t){n[a].parentNode.removeChild(n[a]);if(h.departSelected)t.disabled=true}else{n[a].checked=false;if(h.departSelected)n[a].disabled=true}break}}}E()}function E(){var e=c(h.$selectDepartList).length,t=c(h.$selectStaffList).length;if(e&&t){h.$selectCount.innerHTML="已选择"+e+"个部门，"+t+"名成员"}else if(e&&!t){h.$selectCount.innerHTML="已选择"+e+"个部门"}else if(t&&!e){h.$selectCount.innerHTML="已选择"+t+"名成员"}else{h.$selectCount.innerHTML=""}}function A(){var e=h.$navIndexBtn.cloneNode(true);e.index=1;o(e,"click",function(){if(this.index==c(h.$navList).length)return;s(h.$navList,2,true);k()});return e}function M(){var e=[],t=c(h.$selectStaffList),n=c(h.$selectDepartList);for(var a=0;a<t.length;a++){e.push(t[a].contact)}for(var a=0;a<n.length;a++){e.push(n[a].contact)}h.opts.selectEn&&h.opts.selectEn(e)}var J=true;function P(){if(J&&window.scrollY>600){f(h.$goTopBtn);J=false}else if(window.scrollY<600&&!J){p(h.$goTopBtn);J=true}}function q(){u&&O();if(h.opts.backBtnShow){f(h.$backBtn)}else{p(h.$backBtn)}h.$input.value="";s(h.$navList);s(h.$selectStaffList);s(h.$selectDepartList);i(h.$navList,A());k();if(h.opts.selectSt){var e=h.opts.selectSt();for(var t=0;t<e.departList.length;t++){i(h.$selectDepartList,x(e.departList[t]))}for(var t=0;t<e.personList.length;t++){i(h.$selectStaffList,I(e.personList[t]))}}D();C();E();h.$selectedBtn.innerHTML=h.opts.confirmBtnName;p(h.$ogWrap);f(h.$ctWrap);o(window,"scroll",P)}function F(){r(window,"scroll",L);r(window,"scroll",g);r(window,"scroll",P);p(h.$ctWrap);f(h.$ogWrap)}function O(){u=false;var e=document.body.childNodes,t=e.length,n=a("form"),c=a("div"),s=a("div"),r=a("div"),f=a("div");h.$ogWrap=a("div");h.$ctWrap=a("div");h.$backBtn=a("a");h.$input=a("input");h.$searchBtn=a("a");h.$navList=a("div");h.$navItem=a("a");h.$navIndexBtn=a("a");h.$departList=a("ul");h.$departItem=a("li");h.$checkLabel=a("label");h.$checkBox=a("input");h.$departDetail=a("a");h.$staffList=a("ul");h.$staffItem=a("li");h.$staffDetail=a("div");h.$searchNodata=a("p");h.$selectCount=a("p");h.$selectStaffList=a("ul");h.$selectStaffItem=a("li");h.$selectDepartList=a("ul");h.$selectDepartItem=a("li");h.$selectedBtn=a("a");h.$goTopBtn=a("a");l(h.$ctWrap,"contact-wrap");l(n,"contact-search-bar");l(h.$backBtn,"contact-back-btn");l(h.$input,"contact-search-input");l(h.$searchBtn,"contact-search-btn");l(c,"contact-nav-bar");l(h.$navList,"contact-nav-list");l(h.$navItem,"contact-nav-item");l(h.$navIndexBtn,"contact-nav-item");l(h.$departList,"contact-depart-list");l(h.$departItem,"contact-depart-item");l(h.$checkLabel,"contact-select-label");l(h.$checkBox,"contact-select-checkbox");l(h.$departDetail,"contact-depart-detail");l(h.$staffList,"contact-staff-list");l(h.$staffItem,"contact-staff-item");l(h.$staffDetail,"contact-staff-detail");l(h.$searchNodata,"contact-search-nodata");l(s,"contact-foot-bar");l(h.$selectCount,"contact-selected-count");l(r,"contact-selected-main");l(f,"contact-selected-list");l(h.$selectStaffList,"contact-selected-staff");l(h.$selectStaffItem,"selected-staff-item");l(h.$selectDepartList,"contact-selected-depart");l(h.$selectDepartItem,"selected-depart-item");l(h.$selectedBtn,"contact-confirm-btn");l(h.$goTopBtn,"contact-gotop-btn");d(h.$input,"type","search");d(h.$input,"placeholder","搜索名字/拼音/手机号码/职位");h.$navIndexBtn.innerHTML="首页";d(h.$checkBox,"type","checkbox");h.$searchNodata.innerHTML="没有搜索结果<br>您可以换一个关键词试试";o(h.$backBtn,"click",function(){F()});o(h.$input,"keydown",function(e){if(e.keyCode==13){e.preventDefault();v()}});o(h.$searchBtn,"click",function(){v()});o(h.$selectedBtn,"click",function(){M();F()});o(h.$goTopBtn,"click",function(){document.body.scrollTop=0});i(n,h.$backBtn);i(n,h.$input);i(n,h.$searchBtn);i(c,h.$navList);i(s,h.$selectCount);i(f,h.$selectStaffList);i(f,h.$selectDepartList);i(r,f);i(r,h.$selectedBtn);i(s,r);i(h.$ctWrap,n);i(h.$ctWrap,c);i(h.$ctWrap,h.$departList);i(h.$ctWrap,h.$staffList);i(h.$ctWrap,h.$searchNodata);i(h.$ctWrap,s);i(h.$ctWrap,h.$goTopBtn);i(document.body,h.$ogWrap);for(var p=0;p<t;p++){i(h.$ogWrap,e[0])}i(document.body,h.$ctWrap)}})(window);